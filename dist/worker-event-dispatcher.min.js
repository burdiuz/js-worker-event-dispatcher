!function(e,t){"function"==typeof define&&define.amd?define(["EventDispatcher","MessagePortDispatcher"],t):"object"==typeof module&&module.exports?module.exports=t(require("EventDispatcher"),require("MessagePortDispatcher")):e.WorkerEventDispatcher=t(e.EventDispatcher,e.MessagePortDispatcher)}(this,function(e,t){function r(t,r,n,s){e.Event.call(this,t,r),this.sourceEvent=n,this.client=s}function n(e){function n(t,r){e.postMessage(t,r)}t.call(this,e,n),r.createHandler(l.ERROR,e,this.receiver),r.createHandler(l.LANGUAGECHANGE,e,this.receiver),r.createHandler(l.ONLINE,e,this.receiver),r.createHandler(l.OFFLINE,e,this.receiver)}function s(t,r){function s(){i.port.start()}function a(){i.port.close()}var i=t;e.isObject(t)||(i=new SharedWorker(String(t),r)),n.call(this,i.port),this.start=s,this.close=a}function a(t){function n(e){var t=E.create(e.ports[0],u.SHARED_WORKER_CLIENT);i.push(t),a.dispatchEvent(new r(r.CONNECT,t,e,t))}var s=t||self,a=new e,i=[];s.addEventListener("connect",n),this.addEventListener=a.addEventListener,this.hasEventListener=a.hasEventListener,this.removeEventListener=a.removeEventListener,this.removeAllEventListeners=a.removeAllEventListeners,Object.defineProperties(this,{receiver:{value:a},target:{value:s},clients:{get:function(){return i.slice()}}})}function i(e){function t(){e.start()}function r(){e.close()}n.call(this,e),this.start=t,this.close=r}function o(t){function r(){return s.terminate()}var s=t||self;e.isObject(t)||(s=new Worker(String(t))),n.call(this,s),this.terminate=r}function E(e,t){e===c?Object.defineProperties(this,{type:{value:t}}):o.call(this,e)}var c={},l={};Object.defineProperties(l,{CONNECT:{value:"connect"},MESSAGE:{value:"message"},ERROR:{value:"error"},LANGUAGECHANGE:{value:"languagechange"},ONLINE:{value:"online"},OFFLINE:{value:"offline"}}),r.createHandler=function(e,t,n){function s(e){n.hasEventListener(a)&&n.dispatchEvent(new r(a,e,e))}var a=r.getWorkerEventType(e);return t.addEventListener(e,s),s},r.getWorkerEventType=function(e){var t="";switch(e){case l.CONNECT:t=r.CONNECT;break;case l.MESSAGE:t=r.MESSAGE;break;case l.ERROR:t=r.ERROR;break;case l.LANGUAGECHANGE:t=r.LANGUAGECHANGE;break;case l.ONLINE:t=r.ONLINE;break;case l.OFFLINE:t=r.OFFLINE}return t},Object.defineProperties(r,{CONNECT:{value:"worker:connect"},MESSAGE:{value:"worker:message"},ERROR:{value:"worker:error"},LANGUAGECHANGE:{value:"worker:languagechange"},ONLINE:{value:"worker:online"},OFFLINE:{value:"worker:offline"}});var u={};return Object.defineProperties(u,{DEDICATED_WORKER:{value:"dedicated"},SHARED_WORKER:{value:"shared"},SHARED_WORKER_SERVER:{value:"sharedServer"},SHARED_WORKER_CLIENT:{value:"sharedClient"}}),s.prototype=new E(c,u.SHARED_WORKER),s.prototype.constructor=s,a.prototype=new E(c,u.SHARED_WORKER_SERVER),a.prototype.constructor=a,i.prototype=new E(c,u.SHARED_WORKER_CLIENT),i.prototype.constructor=i,o.prototype=new E(c,u.DEDICATED_WORKER),o.prototype.constructor=o,E.WorkerEvent=r,E.WorkerType=u,E.Dedicated=o,E.Shared=s,E.Server=a,E.Client=i,E.create=function(e,t){var r=null;switch(t){default:case u.DEDICATED_WORKER:r=new o(e);break;case u.SHARED_WORKER:r=new s(e);break;case u.SHARED_WORKER_SERVER:r=new a(e);break;case u.SHARED_WORKER_CLIENT:r=new i(e)}return r},E.self=function(){var e=null;return e="function"==typeof self.postMessage?new o(self):new a(self)},E});