!function(e,t){"function"==typeof define&&define.amd?define(["event-dispatcher","messageport-dispatcher"],t):"object"==typeof module&&module.exports?module.exports=t(require("event-dispatcher"),require("messageport-dispatcher")):e.WorkerEventDispatcher=t(e.EventDispatcher,e.MessagePortDispatcher)}(this,function(e,t){function r(t,r,n,o){e.Event.call(this,t,r),this.sourceEvent=n,this.client=o}function n(e,t,r,n){e===i?Object.defineProperties(this,{type:{value:n}}):(Object.defineProperties(this,{type:{value:l.DEDICATED_WORKER}}),E.call(this,e,t,r))}function o(t,o){function a(e){var t=n.create(e.ports[0],l.SHARED_WORKER_CLIENT);E.dispatchEvent(new r(r.CONNECT,t,e,t))}var s=t||self,E=new e(o);s.addEventListener("connect",a),this.addEventListener=E.addEventListener.bind(E),this.hasEventListener=E.hasEventListener.bind(E),this.removeEventListener=E.removeEventListener.bind(E),this.removeAllEventListeners=E.removeAllEventListeners.bind(E),u.setScopeHandlers(s,E),Object.defineProperties(this,{receiver:{value:E},target:{value:s},type:{value:l.SHARED_WORKER_SERVER}})}function a(e,t,r){function n(){e.start()}function o(){e.close()}u.call(this,e,t,r),this.start=n,this.close=o}function s(t,r,n,o){var s=t;e.isObject(t)||(s=new SharedWorker(String(t),r)),a.call(this,s.port,n,o),u.setAbstractWorkerHandlers(s,this.receiver)}function E(t,r,n){function o(){return a.terminate()}var a=t||self;e.isObject(a)||(a=new Worker(String(t))),u.call(this,a,r,n),u.setScopeHandlers(a,this.receiver),this.terminate=o}var i={},c={};Object.defineProperties(c,{CONNECT:{value:"connect"},MESSAGE:{value:"message"},ERROR:{value:"error"},LANGUAGECHANGE:{value:"languagechange"},ONLINE:{value:"online"},OFFLINE:{value:"offline"}}),r.createHandler=function(e,t,n){function o(e){n.hasEventListener(a)&&n.dispatchEvent(new r(a,e,e))}var a=r.getWorkerEventType(e);return t.addEventListener(e,o),o},r.getWorkerEventType=function(e){var t="";switch(e){case c.CONNECT:t=r.CONNECT;break;case c.MESSAGE:t=r.MESSAGE;break;case c.ERROR:t=r.ERROR;break;case c.LANGUAGECHANGE:t=r.LANGUAGECHANGE;break;case c.ONLINE:t=r.ONLINE;break;case c.OFFLINE:t=r.OFFLINE}return t},Object.defineProperties(r,{CONNECT:{value:"worker:connect"},MESSAGE:{value:"worker:message"},ERROR:{value:"worker:error"},LANGUAGECHANGE:{value:"worker:languagechange"},ONLINE:{value:"worker:online"},OFFLINE:{value:"worker:offline"}});var l={};Object.defineProperties(l,{DEDICATED_WORKER:{value:"dedicated"},SHARED_WORKER:{value:"shared"},SHARED_WORKER_SERVER:{value:"sharedServer"},SHARED_WORKER_CLIENT:{value:"sharedClient"}});var u=function(){function e(e,r,n){function o(t,r){e.postMessage(t,r)}e!==i&&t.call(this,e,o,r,n)}function n(e,t){r.createHandler(c.ERROR,e,t),r.createHandler(c.LANGUAGECHANGE,e,t),r.createHandler(c.ONLINE,e,t),r.createHandler(c.OFFLINE,e,t)}function o(e,t){r.createHandler(c.ERROR,e,t)}function a(){return new e(i)}return e.prototype=t.createNoInitPrototype(),e.prototype.constructor=e,e.setScopeHandlers=n,e.createNoInitPrototype=a,e.setAbstractWorkerHandlers=o,e}();return n.prototype=u.createNoInitPrototype(),n.prototype.constructor=n,o.prototype=e.createNoInitPrototype(),o.prototype.constructor=o,a.prototype=new n(i,null,null,l.SHARED_WORKER_CLIENT),a.prototype.constructor=a,s.prototype=new n(i,null,null,l.SHARED_WORKER),s.prototype.constructor=s,E.prototype=new n(i,null,null,l.DEDICATED_WORKER),E.prototype.constructor=E,n.WorkerEvent=r,n.WorkerType=l,n.CONNECT_EVENT=r.CONNECT,n.DEDICATED_WORKER=l.DEDICATED_WORKER,n.SHARED_WORKER=l.SHARED_WORKER,n.DedicatedWorker=E,n.SharedWorker=s,n.Server=o,n.Client=a,n.create=function(e,t,r,n){var i=null;switch(t){default:case l.DEDICATED_WORKER:i=new E(e,r,n);break;case l.SHARED_WORKER:i=new s(e,null,r,n);break;case l.SHARED_WORKER_SERVER:i=new o(e,r);break;case l.SHARED_WORKER_CLIENT:i=new a(e,r,n)}return i},n.self=function(e,t){var r=null;return r="function"==typeof self.postMessage?new E(self,e,t):new o(self,e)},n});